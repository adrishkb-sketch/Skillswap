{% extends "base.html" %}
{% block content %}

<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold mb-0">{{ course.title }} – Course Builder</h3>
        <a href="/dashboard" class="btn btn-outline-light btn-sm">Back to Dashboard</a>
    </div>

    <!-- ================= ADD CONTENT ================= -->
    <div class="card builder-add-card mb-5 p-4">

        <h5 class="mb-4 fw-semibold">Add New Content</h5>

        <form method="POST"
              action="/course/{{ course.id }}/add-section"
              enctype="multipart/form-data">

            <div class="row g-3">

                <div class="col-md-6">
                    <label class="form-label small text-muted">Section Title</label>
                    <input type="text"
                           name="title"
                           class="form-control"
                           placeholder="Introduction to Python"
                           required>
                </div>

                <div class="col-md-6">
                    <label class="form-label small text-muted">Content Type</label>
                    <select name="content_type"
                            class="form-control"
                            id="content-type"
                            required>
                        <option value="">Select Content Type</option>
                        <option value="video">Video Lesson</option>
                        <option value="document">Document Resource</option>
                        <option value="quiz">Quiz (MCQ)</option>
                    </select>
                </div>

                <div class="col-12 d-none" id="video-field">
                    <label class="form-label small text-muted">Upload Video</label>
                    <input type="file" name="video" class="form-control">
                </div>

                <div class="col-12 d-none" id="document-field">
                    <label class="form-label small text-muted">Upload Document</label>
                    <input type="file" name="document" class="form-control">
                </div>

            </div>

            <div class="mt-4">
                <button class="btn btn-accent px-4">
                    Add Content
                </button>
            </div>

        </form>

    </div>

    <!-- ================= COURSE STRUCTURE ================= -->
    <div class="card builder-structure-card p-4">

        <h5 class="fw-semibold mb-4">Course Structure</h5>

        {% for section in sections %}

        <div class="builder-section mb-4 p-4">

            <div class="d-flex justify-content-between align-items-center mb-3">

                <div>
                    <span class="badge builder-badge me-2">
                        {{ section.content_type|capitalize }}
                    </span>
                    <strong>{{ section.order }}. {{ section.title }}</strong>
                </div>

                <div class="d-flex gap-2">
                    <a href="/section/{{ section.id }}/move-up"
                       class="btn btn-sm btn-outline-light">↑</a>
                    <a href="/section/{{ section.id }}/move-down"
                       class="btn btn-sm btn-outline-light">↓</a>
                    <a href="/section/{{ section.id }}/delete"
                       class="btn btn-sm btn-danger">Delete</a>
                </div>

            </div>

            <!-- ================= QUIZ BUILDER ================= -->
            {% if section.content_type == "quiz" %}

            <div class="quiz-builder mt-3">

                <div class="card p-3 mb-4 quiz-form-card">

                    <h6 class="fw-semibold mb-3">Add Question</h6>

                    <form method="POST"
                          action="/section/{{ section.id }}/add-mcq">

                        <input type="text"
                               name="question"
                               class="form-control mb-3"
                               placeholder="Enter question"
                               required>

                        <div class="row g-2 mb-3">
                            <div class="col-md-6">
                                <input type="text" name="option_a"
                                       class="form-control"
                                       placeholder="Option A" required>
                            </div>
                            <div class="col-md-6">
                                <input type="text" name="option_b"
                                       class="form-control"
                                       placeholder="Option B" required>
                            </div>
                            <div class="col-md-6">
                                <input type="text" name="option_c"
                                       class="form-control"
                                       placeholder="Option C" required>
                            </div>
                            <div class="col-md-6">
                                <input type="text" name="option_d"
                                       class="form-control"
                                       placeholder="Option D" required>
                            </div>
                        </div>

                        <label class="small text-muted mb-2">
                            Select Correct Answer
                        </label>

                        <div class="d-flex gap-4 mb-3">
                            <label><input type="radio" name="correct_answer" value="A" required> A</label>
                            <label><input type="radio" name="correct_answer" value="B"> B</label>
                            <label><input type="radio" name="correct_answer" value="C"> C</label>
                            <label><input type="radio" name="correct_answer" value="D"> D</label>
                        </div>

                        <button class="btn btn-accent btn-sm">
                            Add Question
                        </button>

                    </form>

                </div>

                <!-- EXISTING QUESTIONS -->
                {% for mcq in section.mcqs %}
                <div class="mcq-preview p-3 mb-3">

                    <strong>{{ mcq.question }}</strong>

                    <div class="small mt-2">
                        A) {{ mcq.option_a }}<br>
                        B) {{ mcq.option_b }}<br>
                        C) {{ mcq.option_c }}<br>
                        D) {{ mcq.option_d }}
                    </div>

                    <div class="mt-2 d-flex justify-content-between align-items-center">
                        <span class="text-success small">
                            Correct: {{ mcq.correct_answer }}
                        </span>
                        <a href="/mcq/{{ mcq.id }}/delete"
                           class="btn btn-sm btn-danger">
                           Delete
                        </a>
                    </div>

                </div>
                {% endfor %}

            </div>

            {% endif %}

        </div>

        {% endfor %}

    </div>

</div>


<script>
document.getElementById("content-type")
.addEventListener("change", function() {

    document.getElementById("video-field").classList.add("d-none");
    document.getElementById("document-field").classList.add("d-none");

    if (this.value === "video") {
        document.getElementById("video-field").classList.remove("d-none");
    }

    if (this.value === "document") {
        document.getElementById("document-field").classList.remove("d-none");
    }
});
</script>

{% endblock %}